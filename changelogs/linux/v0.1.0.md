<img src= "https://github.com/thrushlang/.github/blob/main/assets/logos/thrushlang-logo.png" alt= "logo" style= "width: 80%; height: 80%;"></img>

# The Thrush Compiler 

> [!WARNING]  
> Compiler version **v0.1.0** BETA, which does not mean it __**is not stable**__.

> [!CAUTION]
> The documentation is still being created, we apologize if you cannot fully understand it.

### Code Generators

### LLVM Backend

### Available LLVM Backend Targets

- ``x86_64``
- ``AArch64``
- ``RISC-V``
- ``ARM``
- ``MIPS``
- ``PowerPC``
- ``SystemZ``
- ``AMDGPU``
- ``Hexagon``
- ``Lanai``
- ``LoongArch``
- ``MSP430``
- ``NVPTX``
- ``SPARC``
- ``XCore``
- ``BPF``
- ``SPIR-V``
- ``WebAssembly``

## Changelogs

### Keywords 

- `const`: Declaration of static, global, and local variables that cannot be modified after initialization.
- `static`: Declaration of static, global, and local variables that retain their value between function calls.
- `local`: Initial declaration of a variable with local scope, limited to the block it is defined in.
- `fn`: Function declaration, used to define a function.
- `if`: Conditional statement for executing code based on a condition.
- `elif`: Conditional elseif, used for additional conditions in an if statement.
- `else`: Conditional else, used for code execution when prior conditions are false.
- `for`: For loop, used for iterating over a range or collection.
- `while`: While loop, used for repeating code while a condition is true.
- `loop`: Loop construct, similar to Rust's infinite loop with break/continue control.
- `break`: Breaks the loop flow, exiting the loop immediately.
- `continue`: Skips to the next iteration of the loop.
- `struct`: Initial declaration of a structure, defining a custom data type.
- `pass`: Placeholder, similar to '...' in Python, used when no action is needed.
- `instr`: Unlocks low-level instructions for direct hardware manipulation.
- `mut`: Marks a variable or parameter as mutable, allowing modification.
- `as`: Compile-time type casting, used to convert between types.
- `asmfn`: Declares pure assembler functions for low-level code.
- `asm`: Loose assembler value, used for inline assembly.
- `global_asm`: Global assembler, similar to global_asm!() in Rust for defining global assembly code.
- `defer`: Defers execution of pointers or associated resources, typically until the end of the scope.
- `type`: Declares custom types for type aliasing or abstraction.
- `enum`: Declares enumerated types, representing a set of named values.
- `ref`: Direct reference, similar to '&' in C, used for referencing data.
- `new`: Initialization of a structure, used to create an instance.
- `indirect`: Indirectly calling a function, treating functions as pointers.
- `unreachable`: Marks code as unreachable, similar to unreachable!() in Rust, for optimization or error handling.

### Types 

- `s8`: Signed 8-bit integer.
- `s16`: Signed 16-bit integer.
- `s32`: Signed 32-bit integer.
- `s64`: Signed 64-bit integer.
- `u8`: Unsigned 8-bit integer.
- `u16`: Unsigned 16-bit integer.
- `u32`: Unsigned 32-bit integer.
- `u64`: Unsigned 64-bit integer.
- `u128`: Unsigned 128-bit integer.
- `f32`: 32-bit floating-point number.
- `f128`: 128-bit floating-point number.
- `fx86_80`: Extended precision floating-point type, typically 80-bit, used in x86 architectures.
- `fppc_128`: 128-bit floating-point type, specific to PowerPC architectures.
- `bool`: Boolean type, representing true or false.
- `char`: Character type for single Unicode characters.
- `ptr`: Pointer type, used for memory addresses.
- `array`: Array type, representing a fixed-size or dynamic-size collection of elements.
- `Fn`: Function type, representing a function signature.
- `void`: Represents the absence of a type, used for functions with no return value.

### Attributes

- `@asmalignstack`: Specifies stack alignment for assembly functions, ensuring proper stack frame setup.
- `@asmsyntax`: Defines the syntax for inline assembly, such as Intel or AT&T syntax.
- `@asmthrow`: Indicates that an assembly function may throw exceptions, affecting exception handling behavior.
- `@asmeffects`: Specifies side effects of assembly code, used for optimization and safety analysis.
- `@optfuzzing`: Enables optimizations tailored for fuzzing, improving testing and bug detection.
- `@nounwind`: Marks a function as not unwinding the stack, indicating it does not throw exceptions.
- `@packed`: Specifies that a structure or data type should be packed tightly, minimizing padding.
- `@heap`: Indicates that a variable or object is allocated on the heap.
- `@stack`: Indicates that a variable or object is allocated on the stack.
- `@public`: Marks a function or variable as publicly accessible outside the module.
- `@extern`: Declares a function or variable as external, defined in another module or library.
- `@ignore`: Instructs the compiler to ignore specific warnings or optimizations for the annotated code.
- `@hot`: Marks a function as frequently executed, prioritizing optimizations for performance.
- `@minsize`: Optimizes a function for minimal code size rather than performance.
- `@alwaysinline`: Forces the compiler to always inline the function, regardless of optimization settings.
- `@noinline`: Prevents the compiler from inlining the function, even if it would optimize performance.
- `@inline`: Hints to the compiler to inline the function, subject to optimization heuristics.
- `@safestack`: Enables safe stack allocation, separating sensitive data to prevent stack-based attacks.
- `@weakstack`: Specifies a weaker stack protection mechanism, balancing security and performance.
- `@strongstack`: Enforces strong stack protection, prioritizing security over performance.
- `@precisefp`: Ensures precise floating-point operations, disabling aggressive optimizations that may alter results.
- `@convention`: Specifies the calling convention for a function, such as C, Swift, or Haskell.

### Builtins

- `halloc`: Allocates memory on the heap, similar to malloc, returning a pointer to the allocated memory.
- `sizeof`: Returns the size of a type or variable in bytes, evaluated at compile time.
- `memset`: Sets a block of memory to a specified value, typically used to initialize memory.
- `memmove`: Copies a block of memory from a source to a destination, handling overlapping regions safely.
- `memcpy`: Copies a block of memory from a source to a destination, assuming non-overlapping regions.
- `alignof`: Returns the alignment requirement of a type in bytes, evaluated at compile time.

### Atomic

- `volatile`: Indicates that a variable's value may change unexpectedly, preventing compiler optimizations that assume stability.
- `lazythread`: Specifies lazy initialization for thread-local variables, deferring creation until first access.
- `atomnone`: Indicates no atomicity guarantee, allowing non-atomic access to a variable.
- `atomfree`: Specifies that an operation is lock-free, avoiding synchronization overhead.
- `atomrelax`: Specifies a relaxed memory ordering for atomic operations, allowing reordering for performance.
- `atomgrab`: Acquires a resource or lock atomically, ensuring exclusive access.
- `atomdrop`: Releases a resource or lock atomically, allowing other threads to access it.
- `atomsync`: Ensures sequential consistency for atomic operations, enforcing strict memory ordering.
- `atomstrict`: Specifies the strictest memory ordering for atomic operations, preventing any reordering.
- `threadinit`: Initializes a thread-local variable or resource at thread startup.
- `threaddyn`: Specifies dynamic thread-local storage, allocated at runtime.
- `threadexec`: Indicates execution context specific to a thread, often used for thread-specific operations or scheduling.

## Command Line

```console
The Thrush Compiler

Usage: thrushc [-flags | --flags] [files..]

General Commands:

• -h, --help, help Show help message.
• -v, --version, version Show the version.

LLVM Commands:

• llvm-print-target-triples Show the current LLVM target triples supported.
• llvm-print-targets Show the current LLVM target supported.
• llvm-print-supported-cpus Show the current LLVM supported CPUs for the current LLVM target.
• llvm-print-host-target-triple Show the host LLVM target triple.

General flags:

• -build-dir Set the build directory.
• -clang Enable embedded Clang for linking.
• -gcc [usr/bin/gcc] Speciefies GNU Compiler Collection (GCC) for linking.
• -custom-clang [/usr/bin/clang] Specifies the path for use of an external Clang for linking.
• -start Marks the start of arguments to the active external or built-in linking compiler.
• -end Marks the end of arguments to the active external or built-in linker compiler.

Compiler flags:

• -llvm-backend Enable the usage of the LLVM backend infrastructure.
• -target [x86_64] Set the LLVM target.
• -target-triple [x86_64-pc-linux-gnu] Set the LLVM target triple.
• -cpu [haswell] Specify in LLVM the CPU to optimize.
• -cpu-features [+sse2,+cx16,+sahf,-tbm] Specify in LLVM the new features of the CPU to use.
• -emit [llvm-bc|llvm-ir|asm|raw-llvm-ir|raw-llvm-bc|raw-asm|obj|ast|tokens] Compile the code into specified representation.
• -print [llvm-ir|raw-llvm-ir|tokens] Displays the final compilation on stdout.
• -opt [O0|O1|O2|mcqueen] Optimization level.

Extra compiler flags:

• --opt-passes [-p{passname}] Pass a list of custom optimization passes to the LLVM optimizator.
• --modificator-passes [loopvectorization;loopunroll;loopinterleaving;loopsimplifyvectorization;mergefunctions] Pass a list of custom modificator passes to the LLVM optimizator.
• --reloc [static|pic|dynamic] Indicate how references to memory addresses and linkage symbols are handled.
• --codemodel [small|medium|large|kernel] Define how code is organized and accessed at machine code level.

Special flags:

• -llinker Transform the compiler into the LLVM linker.
• -llinker-flavor Specify the build flavor for the LLVM linker.

Useful flags:

• --debug-clang-command Displays the generated command for Clang in the phase of linking.
• --debug-gcc-commands Displays the generated command for GCC in the phase of linking.

• --clean-tokens Clean the compiler folder that holds the lexical analysis tokens.
• --clean-assembler Clean the compiler folder containing emitted assembler.
• --clean-llvm-ir Clean the compiler folder containing the emitted LLVM IR.
• --clean-llvm-bitcode Clean the compiler folder containing emitted LLVM Bitcode.
• --clean-objects Clean the compiler folder containing emitted object files.

• --no-obfuscate-archive-names Stop generating name obfuscation for each file; this does not apply to the final build.
• --no-obfuscate-ir Stop generating name obfuscation in the emitted IR code.
```

## LLVM Linker Flavors

This can be used by using the `-llinker` and `-llinker-flavor` flags in the compiler.

- `COFF`
- `MACH0`
- `ELF`
- `WASM`

## Embedded Linking Compilers

### Windows

- `Clang x86_64 v18.0.1`

### Linux

- `Clang x86_64 v17.0.6`